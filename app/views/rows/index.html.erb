<%= content_for :sidebar do %>
  <p>
    <a href="<%=edit_form_path(@form, :edit_key => @form.edit_key)%>" target="_blank" title="new form" class='button' >编辑表单</a>
  <p>
  <p><%=link_to '查看表单',form_path(@form),:target => '_blank', :class => 'button' %></p>
  <p><%=link_to '导出CSV',form_rows_path(@form, :format => :csv, :edit_key => @form.edit_key),:target => '_blank', :class => 'button' %></p>
  <p><%=link_to '导出XLS',form_rows_path(@form, :format => :xls, :edit_key => @form.edit_key),:target => '_blank', :class => 'button' %></p>
<% end %>

<%= pagenav_area do -%>
  <span><%=link_to '所有问卷',forms_path%> / <%=h @form.title %>  </span>
<% end -%>   
<div class="info_grid">
<table class='grid' id='info_grid' cellspacing="0" cellpadding="0">
  <thead>
    <tr>  
      <% @form.fields.each do |field| %>                         
      <th><%= field.name %></th>           
      <% end %> 
      <th>时间</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody>  
  <% @rows.each do |row| -%>
  <tr>           
    <% @form.fields.each do |field| %>              
    <td class="<%='name' if field.name == '姓名' %>"><div class='info_item'><%= row.send('f' + field.id) %></div></td>
    <% end -%>
    <td><div class='info_item'><%= row.created_at.to_time.to_formatted_s(:datetime_military) %></div></td> 
    <td class='opt'>
      <div class='info_item'><%= link_to '编辑', '#', :class => 'ag' %> <%= link_to '删除', '#', :class => 'ag' %></div>
    </td>
  </tr>      
  <% end -%>
  </tbody>
</table>   
</div>
<% if false %>             
 <div class='info_item'><%= link_to '编辑备注', edit_dashboard_event_row_path(@event, row), :class => 'fancybox ag' %>  <%= link_to "删除", dashboard_event_row_path(@event, row), :method => 'delete', :confirm => '确定要删除吗？',:class => 'ag' %></div>       
<div id="pager"></div> 
<script type="text/javascript" charset="utf-8">
  jQuery("#rows").jqGrid({
    url:'?format=json&edit_key=<%= @form.edit_key %>', 
    datatype: "json", 
    colNames:[
      'INTERN',
      'ID',
      <% @form.fields.each do |field| %>
        '<%= field.name %>',
      <% end %>
      '时间',
      '操作'],
    colModel:[
      {name:'id',index:'id', width:120, hidden:true, editable:true},
      {name:'number',index:'number', width:30, align:"right"}, 
      <% @form.fields.each do |field| %>
        {name:'f<%= field.id.to_s %>',index:'f<%= field.id.to_s %>', width:150, editable:true,align:"right"}, 
      <% end %>
      {name:'time',index:'time', width:120},
      {name:'option',index:'option', width:120}
    ], 
    rowNum: <%= @rows.size %>, 
    rowList:[100], 
    pager: '#pager', 
    sortname: 'id', 
    height: 400,
    viewrecords: true, 
    sortorder: "desc", 
    gridComplete: function() { 
      var options = jQuery("#rows").jqGrid('getDataIDs'); 
      for(var i=0;i < options.length;i++){ 
        var cl = options[i]; 
        be = "<a href='#' onclick=\"jQuery('#rows').jqGrid('editRow', '"+cl+"');\">编辑</a>|"; 
        se = "<a href='#' onclick=\"jQuery('#rows').jqGrid('saveRow', '"+cl+"');\">保存</a>|"; 
        ce = "<a href='#' onclick=\"jQuery('#rows').jqGrid('restoreRow', '"+cl+"');\">取消</a>";
        jQuery("#rows").jqGrid('setRowData',options[i],{option:be+se+ce}); 
      } 
    },
    editurl: "rows",
    caption:"<%= @form.title %>"
  }); 
  
  jQuery("#rows").jqGrid('navGrid',"#pager",{edit:true,add:false,del:true}); 
</script>
<% end %>