<%= content_for :headers do %>
  <%= javascript_include_tag "fancybox/jquery.fancybox-1.3.1.pack" %>
  <script type="text/javascript" charset="utf-8">
    $(document).ready(function(){     
      $('#opt .button').button();
     })    
  </script>
<% end %>

<%= content_for :pagenav do -%> 
<div id="page_nav">
    <span><%=link_to '所有问卷',forms_path%> / <%= @form.title %></span>    
    <div class='right'>
    </div>     
</div>
<div class='span-24' id='opt'>  
  <a href="#" onclick="window.open('<%=edit_form_path(@form, :edit_key => @form.edit_key)%>', '<%= @form.id %>', 'toolbar=yes,resizable=yes,scrollbars=no,width=820,height=700,left=0,top=0');" title="编辑" class='button' >编辑表单</a>  
  <%=link_to '查看表单',form_path(@form),:target => '_blank',:class => 'button'%>
</div> 
  <div class='span-24 border'>    
    <b><%=@form.klass.count %>条回应</b> |  
     <%=link_to '导出为文本文件',form_rows_path(@form, :format => :csv, :edit_key => @form.edit_key),:target => '_blank',:class => 'ag' %> 
    <%=link_to '导出为Excel文件',form_rows_path(@form, :format => :xls, :edit_key => @form.edit_key),:target => '_blank',:class => 'ag' %>    
  </div>
<% end %>     
<span style='color:#999;'>操作提示:双击回应条目可展开</span>
<div class='span-24' id='results'>     
<table id='rows' cellspacing="0" cellpadding="0" class='grid'>  
  <thead>
    <tr>      
      <th>时间</th>
      <% @form.fields.each do |field| %>
      <th><%=truncate field.name,:length => 18%></th> 
      <% end %>
    </tr>
  </thead>
  <tbody>  
 <% @rows.each do |row| %>
  <tr id="<%=row.id%>">     
    <td><div class='info_item time'><%=row.created_at.to_time.to_formatted_s(:datetime_short)%></div></td>          
    <% @form.fields.each do |field| %>         
      <td><div class='info_item'><%=row.send("f#{field.id}") %></div></td>
    <% end -%>
  </tr>      
  <% end -%>
  </tbody>
</table>  
</div>             
<div style='clear:both'></div>
<div style='margin:10px;'>
  <%=raw will_paginate @rows,:class => 'flickr_pagination',:previous_label => '前翻',:next_label => '后翻' %>   
</div>
   
<% @rows.each do |row| %>                    
<div id="row_<%=row.id%>"  style="display:none;">
  <h3>回应详细</h3>           
  <div class='row_content'>
  <table class='grid big' cellspacing="0" cellpadding="0"> 
    <col width='30%'>
    <col width='70%'>
    <tbody>
      <% @form.fields.sort {|f1, f2| f1.position <=> f2.position}.each do |field| %>
        <tr>
          <td class='name'><%= field.name %></td>
          <td><%= row.send('f' + field.id)%></td>
        </tr>
      <% end %>
     </tbody>
    </table> 
     </div>     
    <div style='text-align:center;'>
      <%=link_to '编辑',edit_form_row_path(@form,row, :edit_key => @form.edit_key),:class => 'button'%>  <%=link_to '删除', form_row_path(@form, row, :edit_key => @form.edit_key), :confirm => '你确定删除此记录嘛?', :method => 'delete',:class => 'button'%>
    </div>
</div>    
<% end %>